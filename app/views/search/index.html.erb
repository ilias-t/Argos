<div id="map">
</div>

<div id="search"></div>
<div id="geocode"></div>

<script>
var map, geocoder, data, searcher;

searcher = new google.maps.Geocoder();

require([
  "esri/map", "esri/dijit/Geocoder", "dojo/domReady!"
  ], function(Map, Geocoder) {
    map = new Map("map",{
      basemap: "gray",
      center: [-98.35, 39.50],
      zoom: 4
    });
    geocoder = new Geocoder({
      map: map,
      autoNavigate: false
    }, "search");
    geocoder.startup();
    geocoder.on('find-results', function(e){
      require(["esri/graphic", "esri/symbols/SimpleMarkerSymbol"], function(Graphic, SimpleMarkerSymbol){
        var markerSymbol = new SimpleMarkerSymbol();
        map.graphics.add(new Graphic(e.results.results[0].feature.geometry, markerSymbol));
      });
      $.getJSON("search?query="+geocoder.value, function(json){data = json}).done(function(){
        _.each(data.locations, function(element){
          searcher.geocode( { 'address': element}, function(stuff, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              require([
                "esri/geometry/Point",
                "esri/graphic",
                "esri/symbols/SimpleMarkerSymbol"
               ], function(Point, Graphic, SimpleMarkerSymbol) {
                 var point = new Point(stuff[0].geometry.location.A, stuff[0].geometry.location.k);
                 var markerSymbol = new SimpleMarkerSymbol();
                 map.graphics.add(new Graphic(point, markerSymbol));
               });
            }
          });
        });
      });
    });
    });




    </script>
