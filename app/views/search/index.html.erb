<div id="map">
</div>

<div id="search"></div>
<div class="grid">
  <div class="money-trail">
    <h2>The Money Trail</h2>
    <div class="timeline">
      <a id='sup' data-tooltip='hello'><div class="bubble"></div></a>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
    </div>
  </div>

  <div class="company-stats">
    <h2>Company Name</h2>
    <h1 id="total-funding">$12M</h1>
    <img src="http://placekitten.com/g/150/150">
    <p>Sollicitudin zzz stuck in a tree attack your ankles kittens suspendisse, sollicitudin stretching toss the mousie nunc lay down in your way. Run vel knock over the lamp I don't like that food, enim eat the grass sniff jump on the table pellentesque sagittis. Elit faucibus knock over the lamp rhoncus leap non, bibendum tristique sleep on your face quis. Judging you suspendisse tortor suspendisse sleep on your keyboard, nibh I don't like that food sunbathe stretching iaculis.</p>
  </div>
</div>

<script>

function addingEventListeners(){
  $("#map_graphics_layer circle").on("click", function(){
    newCompanySearch = this.id;
    geocoder.value = newCompanySearch;
    geocoder.find();
    $("#search_input").val(newCompanySearch);
  });
}

$(document).on("click", function(){
  addingEventListeners();
});

function addIDsToCircles(arr){
  $.each(arr.companies,function(index, value){
      console.log("adding ids");
      $("#map_graphics_layer circle")[index + 1].id = value;
  })
  addingEventListeners();
}

var map, geocoder, data, searcher;

searcher = new google.maps.Geocoder();

require([
  "esri/map", "esri/dijit/Geocoder", "dojo/domReady!"
  ], function(Map, Geocoder) {
    map = new Map("map",{
      basemap: "gray",
      center: [-98.35, 39.50],
      zoom: 4
    });
    geocoder = new Geocoder({
      map: map,
      autoNavigate: false
    }, "search");
    geocoder.startup();
    geocoder.on('find-results', function(e){
      map.graphics.clear();
      require(["esri/graphic", "esri/symbols/SimpleMarkerSymbol"], function(Graphic, SimpleMarkerSymbol){
        var markerSymbol = new SimpleMarkerSymbol({
          "color": [28,128,242,100]
        });
        map.graphics.add(new Graphic(e.results.results[0].feature.geometry, markerSymbol));
      });
      $.getJSON("search?query="+geocoder.value, function(json){data = json}).done(function(){
        window.circleData = data;
        var counter = 1;
        _.each(data.locations, function(element, index){
          searcher.geocode( { 'address': element}, function(stuff, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              require([
                "esri/geometry/Point",
                "esri/graphic",
                "esri/symbols/SimpleMarkerSymbol"
                ], function(Point, Graphic, SimpleMarkerSymbol) {
                 var point = new Point(stuff[0].geometry.location.A, stuff[0].geometry.location.k);
                 var markerSymbol = new SimpleMarkerSymbol({
                  "color": [212,42,65,100]
                });
                 // markerSymbol["company_name"] = data.companies[index];
                 newGraphicPoint = new Graphic(point, markerSymbol);
                 map.graphics.add(newGraphicPoint);
                 counter++;
                 if (counter === window.circleData.locations.length) {
                    addIDsToCircles(window.circleData);
                  };
                  //window.circleData = data; //global variable
                 });
            }
          });
        });
      });
    });
});

</script>

<script type="text/javascript">

</script>
